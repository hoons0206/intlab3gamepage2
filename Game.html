<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>2P 화면</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #f0f0f0;
    }
    #conveyor {
      position: relative;
      width: 100%;
      height: 120px;
      background: #ddd;
      overflow: hidden;
    }
    .box-img {
      position: absolute;
      width: 70px;
      height: 70px;
      top: 25px;
      transition: left 0.03s linear;
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD4d7JvLj90ar0Q8o_AEXFTjhMZF-oI-DU",
      authDomain: "interaction-lab-3-c4513.firebaseapp.com",
      databaseURL: "https://interaction-lab-3-c4513-default-rtdb.firebaseio.com",
      projectId: "interaction-lab-3-c4513",
      storageBucket: "interaction-lab-3-c4513.appspot.com",
      messagingSenderId: "40397314576",
      appId: "1:40397314576:web:b6bbbeb99fd43bda508895"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
</head>
<body>

<div id="conveyor"></div>

<script>
  const conveyor = document.getElementById('conveyor');
  const boxWidth = 70;
  const speed = 2;

  const imgMap = {
    'type1': ['html/media/red1.png', 'html/media/red2.png'],
    'type2': ['html/media/green1.png', 'html/media/green2.png'],
    'type3': ['html/media/blue1.png', 'html/media/blue2.png'],
    'type4': ['html/media/yellow1.png', 'html/media/yellow2.png']
  };

  const incomingBoxesRef = db.ref('game/2p_incomingBoxes');
  const boxes = [];

  incomingBoxesRef.on('child_added', snapshot => {
    const data = snapshot.val();
    if (!data || !data.type || !data.state) return;

    const img = document.createElement('img');
    img.src = imgMap[data.type][parseInt(data.state) - 1];
    img.classList.add('box-img');
    img.style.left = '0px';

    const boxObj = {
      el: img,
      left: 0
    };

    conveyor.appendChild(img);
    boxes.push(boxObj);
  });

  // 매 프레임마다 박스 이동
  setInterval(() => {
    for (let i = boxes.length - 1; i >= 0; i--) {
      const box = boxes[i];
      box.left += speed;
      box.el.style.left = box.left + 'px';

      // 화면 밖으로 나간 박스 제거
      if (box.left > window.innerWidth) {
        box.el.remove();
        boxes.splice(i, 1);
      }
    }
  }, 1000 / 30); // 약 30FPS
</script>

</body>
</html>

